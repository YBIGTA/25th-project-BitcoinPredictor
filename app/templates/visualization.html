<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candlestick Chart</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #333;
        }

        #controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="date"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #0056b3;
        }

        #candlestick-chart {
            width: 100%;
            max-width: 1200px;
            height: 80vh; /* í™”ë©´ í¬ê¸°ì— ë”°ë¼ ë°˜ì‘í˜• í¬ê¸° */
        }

        #timeframe-controls {
            margin-bottom: 20px;
        }

        #legend {
            margin-top: 20px;
            display: flex;
            flex-direction: row;
            gap: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color-box {
            width: 20px;
            height: 20px;
        }
        #chart-container {
        position: relative;
        width: 100%;
        max-width: 1200px;
        height: 80vh;
        margin: 0 auto;
    }

        /* ë‹ë³´ê¸° ë° ì¶•ì†Œ ë²„íŠ¼ì„ ì°¨íŠ¸ì˜ ì˜¤ë¥¸ìª½ ìœ„ë¡œ ë°°ì¹˜ */
        #zoom-button, #reset-button {
            position: absolute;
            top: 10px;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            z-index: 10; /* ë²„íŠ¼ì´ ì°¨íŠ¸ ìœ„ì— ë‚˜íƒ€ë‚˜ë„ë¡ ì„¤ì • */
        }

        #zoom-button {
            right: 50px; /* ì˜¤ë¥¸ìª½ì—ì„œ ì•½ê°„ ì™¼ìª½ìœ¼ë¡œ */
        }

        #reset-button {
            right: 10px; /* ì˜¤ë¥¸ìª½ ëì— ìœ„ì¹˜ */
        }
    </style>
</head>
<body>
    <h1>Bitcoin Price Chart</h1>
    <!-- ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ì¶”ê°€ -->
    <div id="chart-container">
        <!-- ë‹ë³´ê¸° ë²„íŠ¼ ì¶”ê°€ -->
        <button id="zoom-button" onclick="zoomToThreeMonths()">ğŸ”</button>
        <button id="reset-button" onclick="resetChart()">ğŸ”„</button>

        <div id="candlestick-chart"></div>
    </div>

    <div id="controls">
        <label for="start-date">Start Date:</label>
        <input type="date" id="start-date">
        
        <label for="end-date">End Date:</label>
        <input type="date" id="end-date">
        
        <button onclick="updateChart()">Update Chart</button>
    </div>
    
    <div id="timeframe-controls">
        <button onclick="setTimeframe('minute')">ë¶„ë´‰</button>
        <button onclick="setTimeframe('day')">ì¼ë´‰</button>
        <button onclick="setTimeframe('week')">ì£¼ë´‰</button>
    </div>

    <script>
let selectedTimeframe = 'week';
let zoomedStartDate = null;
let zoomedEndDate = null;

function setTimeframe(timeframe) {
    selectedTimeframe = timeframe;
    if (zoomedStartDate && zoomedEndDate) {
        // ìµœê·¼ 3ê°œì›”ì˜ ë°ì´í„°ë¡œ ì°¨íŠ¸ë¥¼ ì—…ë°ì´íŠ¸
        updateChart(zoomedStartDate, zoomedEndDate);
    } else {
        updateChart();
    }
}

async function fetchData(startDate = null, endDate = null) {
    let url = `/predict?timeframe=${selectedTimeframe}`;
    if (startDate && endDate) {
        url += `&start_date=${startDate}&end_date=${endDate}`;
    }
    const response = await fetch(url);
    const json = await response.json();
    return json.data;
}

async function updateChart(startDate = null, endDate = null) {
    const data = await fetchData(startDate, endDate);

    // ë°ì´í„°ê°€ ì¶©ë¶„í•œì§€ í™•ì¸
    if (data.length === 0) {
        document.getElementById('candlestick-chart').innerHTML = "<p>No data available for the selected date range.</p>";
        return;
    }

    const dates = data.map(row => row.Date);
    const opens = data.map(row => row.Open);
    const highs = data.map(row => row.High);
    const lows = data.map(row => row.Low);
    const closes = data.map(row => row.Close);

    const trace = {
        x: dates,
        close: closes,
        decreasing: {line: {color: 'red'}},
        high: highs,
        increasing: {line: {color: 'green'}},
        low: lows,
        open: opens,
        type: 'candlestick',
        xaxis: 'x',
        yaxis: 'y'
    };

    const layout = {
        title: `Bitcoin Price - ${selectedTimeframe.toUpperCase()}`,
        xaxis: {title: 'Date'},
        yaxis: {title: 'Price'},
        showlegend: true,
        responsive: true
    };

    Plotly.newPlot('candlestick-chart', [trace], layout);
}

async function zoomToThreeMonths() {
    selectedTimeframe = 'day';  // ì¼ë´‰ìœ¼ë¡œ ì„¤ì •
    const endDate = new Date();
    const startDate = new Date();
    startDate.setMonth(endDate.getMonth() - 3);

    // ë‚ ì§œë¥¼ 'YYYY-MM-DD' í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    zoomedStartDate = startDate.toISOString().split('T')[0];
    zoomedEndDate = endDate.toISOString().split('T')[0];

    // ì¼ë´‰ìœ¼ë¡œ ìµœê·¼ 3ê°œì›” ë°ì´í„°ë¡œ ì°¨íŠ¸ë¥¼ ì—…ë°ì´íŠ¸
    updateChart(zoomedStartDate, zoomedEndDate);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì°¨íŠ¸ ì´ˆê¸°í™” (ê¸°ë³¸: ì£¼ë´‰, ìµœê·¼ 1ë…„ì¹˜ ë°ì´í„°)
updateChart();
    </script>
</body>
</html>
